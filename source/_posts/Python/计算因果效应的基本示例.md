---
title: è®¡ç®—å› æœæ•ˆåº”çš„åŸºæœ¬ç¤ºä¾‹
date: 2025-04-29 00:07:05
tags: [å› æœæ¨æ–­]
categories: [[Python, å› æœæ¨æ–­]]
---


<!-- reticulate::use_python("C:/ProgramData/Anaconda3/python.exe") -->
<!-- https://www.pywhy.org/dowhy/v0.12/example_notebooks/dowhy_simple_example.html -->

è¿™æ˜¯ä¸€ä¸ªå…³äº DoWhy
å› æœæ¨æ–­åº“çš„å¿«é€Ÿå…¥é—¨ä»‹ç»ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†åŠ è½½ä¸€ä¸ªç¤ºä¾‹æ•°æ®é›†ï¼Œå¹¶ä¼°è®¡ä¸€ä¸ªï¼ˆé¢„å…ˆæŒ‡å®šçš„ï¼‰å¤„ç†å˜é‡å¯¹ä¸€ä¸ªï¼ˆé¢„å…ˆæŒ‡å®šçš„ï¼‰ç»“æœå˜é‡çš„å› æœæ•ˆåº”ã€‚

# åŸºç¡€æ¦‚å¿µ

åœ¨å¼€å§‹ä»£ç å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š

<ul style="margin-top:0;">
<li style="margin-top:2px;margin-bottom:2px;">
<strong>å› æœæ•ˆåº”</strong>ï¼šæ¯”å¦‚â€åƒè¯(v0)å¯¹åº·å¤(y)çš„å½±å“â€ï¼Œè€Œä¸æ˜¯ç®€å•çš„ç›¸å…³æ€§
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>æ²»ç–—å˜é‡ Treatment</strong>ï¼šæˆ‘ä»¬å…³æ³¨çš„å¹²é¢„å› ç´ ï¼Œå¦‚æ˜¯å¦åƒè¯
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>ç»“æœå˜é‡ Outcome</strong>ï¼šæˆ‘ä»¬å…³å¿ƒçš„ç»“æœï¼Œå¦‚å¥åº·ç¨‹åº¦
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>æ··æ‚å› ç´ 
Confounder</strong>ï¼šæ—¢å½±å“æ²»ç–—åˆå½±å“ç»“æœçš„å˜é‡ï¼Œå¦‚ç—…æƒ…ä¸¥é‡ç¨‹åº¦
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>å·¥å…·å˜é‡ Instrumental
Variable</strong>ï¼šåªå½±å“æ²»ç–—ä½†ä¸ç›´æ¥å½±å“ç»“æœçš„å˜é‡
</li>
</ul>

# å¯¼å…¥æ‰€éœ€åº“

``` python
import numpy as np
import dowhy.datasets
from dowhy import CausalModel
```

# æ„é€ æ¨¡æ‹Ÿæ•°æ®

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åŠ è½½ä¸€ä¸ªæ•°æ®é›†ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªæ•°æ®é›†ï¼Œå…¶ä¸­å…±åŒåŸå› ä¸å¤„ç†å˜é‡ä¹‹é—´ã€å…±åŒåŸå› ä¸ç»“æœå˜é‡ä¹‹é—´éƒ½æ˜¯çº¿æ€§å…³ç³»ã€‚

`beta`æ˜¯çœŸå®çš„å› æœæ•ˆåº”ã€‚

``` python
data = dowhy.datasets.linear_dataset(
  beta = 10,                      # çœŸå®çš„å› æœæ•ˆåº”å¤§å°
  num_common_causes = 5,          # 5ä¸ªæ··æ‚å› ç´ 
  num_instruments = 2,            # 2ä¸ªå·¥å…·å˜é‡  
  num_effect_modifiers = 1 ,      # 1ä¸ªæ•ˆåº”ä¿®é¥°å˜é‡
  num_samples = 5000,             # 5000ä¸ªæ ·æœ¬
  treatment_is_binary = True,     # æ²»ç–—æ˜¯äºŒå…ƒçš„(æ˜¯/å¦)
  stddev_treatment_noise = 10,    # æ²»ç–—å˜é‡çš„å™ªå£°å¤§å°
  num_discrete_common_causes = 1  # 1ä¸ªç¦»æ•£å‹æ··æ‚å› ç´ 
)

df = data["df"]                   # è·å–ç”Ÿæˆçš„æ•°æ®æ¡†
df.head()                         # æŸ¥çœ‹å‰å‡ è¡Œæ•°æ®
##          X0   Z0        Z1        W0  ...        W3  W4     v0          y
## 0 -0.056755  0.0  0.236210  0.428525  ... -3.136011   0  False -16.989686
## 1 -1.279875  0.0  0.351631 -1.106842  ... -0.911872   2  False  -4.094126
## 2  1.637977  0.0  0.225216 -0.576326  ... -0.784004   0  False  -2.876001
## 3  0.920122  0.0  0.894980  1.385943  ... -3.609170   2  False -16.598985
## 4  0.400167  0.0  0.307448 -0.024350  ...  0.391856   1  False  -7.492589
##                                                                          
##                           [5 rows x 10 columns]
```

<strong style="color:#00A087;font-size:16px;">è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ¨¡æ‹Ÿæ•°æ®é›†</strong>ï¼š

<ul style="margin-top:0;">
<li style="margin-top:2px;margin-bottom:2px;">
<strong>beta = 10</strong>ï¼šè®¾å®šçœŸå®çš„å› æœæ•ˆåº”æ˜¯
10ï¼Œæ¯”å¦‚åƒè¯å¹³å‡èƒ½è®©å¥åº·è¯„åˆ†æé«˜ 10 åˆ†
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>num_common_causes = 5</strong>ï¼šæœ‰ 5
ä¸ªå…±åŒå½±å“å› ç´ ï¼Œæ—¢å½±å“æ²»ç–—ä¹Ÿå½±å“ç»“æœ
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>num_instruments = 2</strong>ï¼šæœ‰ 2
ä¸ªå·¥å…·å˜é‡ï¼Œåªå½±å“æ²»ç–—ä¸å½±å“ç»“æœ
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>num_effect_modifiers = 1</strong>ï¼šç”Ÿæˆ 1
ä¸ªæ•ˆåº”ä¿®é¥°å˜é‡ï¼Œè¿™ä¸ªå˜é‡ä¼šæ”¹å˜æ²»ç–—çš„æ•ˆæœå¤§å°
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>num_samples = 5000</strong>ï¼š5000 ä¸ªæ ·æœ¬
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>treatment_is_binary = True</strong>ï¼šæ²»ç–—å˜é‡æ˜¯äºŒå…ƒçš„
</li>
</ul>

<strong style="color:#E50914;font-size:16px;">ç”Ÿæˆçš„æ•°æ®ç»“æ„</strong>ï¼š

<ul style="margin-top:0;">
<li style="margin-top:2px;margin-bottom:2px;">
<strong>Z0, Z1</strong>ï¼šå·¥å…·å˜é‡
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>W0-W4</strong>ï¼šæ··æ‚å˜é‡
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>v0</strong>ï¼šæ²»ç–—å˜é‡ï¼Œæ˜¯å¦åƒè¯
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>y</strong>ï¼šç»“æœå˜é‡ï¼Œå¥åº·è¯„åˆ†
</li>
<li style="margin-top:2px;margin-bottom:2px;">
<strong>X0</strong>ï¼šæ•ˆåº”ä¿®é¥°å˜é‡
</li>
</ul>
<p>
ç”Ÿæˆä¸€ä¸ªçº¿æ€§ç»“æ„çš„æ•°æ®é›†ï¼Œæ¨¡æ‹Ÿäº†çœŸå®çš„å› æœå…³ç³»ã€‚beta = 10
ä»£è¡¨çœŸå®çš„å› æœæ•ˆåº”ï¼ˆtreatment å¯¹ outcome çš„çœŸå®å¹³å‡å½±å“æ˜¯10ï¼‰ã€‚
</p>
<p>
æ•°æ®æœ‰ 5 ä¸ªæ··æ‚å˜é‡ï¼ˆcommon causesï¼‰ï¼Œ2ä¸ªå·¥å…·å˜é‡ï¼ˆinstrumentsï¼‰ï¼Œ1
ä¸ªæ•ˆåº”ä¿®é¥°å˜é‡ï¼ˆeffect modifierï¼‰ï¼Œæ ·æœ¬é‡
5000ï¼Œå¤„ç†å˜é‡æ˜¯äºŒå…ƒçš„ï¼ˆ0/1ï¼‰ï¼Œtreatment æœ‰å™ªå£°ã€‚
</p>
<p>
è¯·æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ pandas DataFrame æ¥åŠ è½½æ•°æ®ï¼Œå› ä¸ºç›®å‰ï¼ŒDoWhy
åªæ”¯æŒä»¥ pandas DataFrame ä½œä¸ºè¾“å…¥ã€‚
</p>

# æ„å»ºå› æœæ¨¡å‹

ç¬¬ä¸€ç§ï¼ˆWithout graphï¼‰ï¼Œæ²¡æœ‰å› æœå›¾ï¼Œå¿…é¡»æ‰‹åŠ¨æŒ‡å®šå…±åŒåŸå› ï¼ˆcommon
causesï¼‰ã€å·¥å…·å˜é‡ï¼ˆinstrumentsï¼‰ã€æ•ˆåº”ä¿®é¥°å˜é‡ï¼ˆeffect
modifiersï¼‰ç­‰ï¼›ç¬¬äºŒç§ï¼ˆWith graphï¼‰ï¼Œä½ ç›´æ¥è¾“å…¥äº†ä¸€ä¸ªå› æœå›¾ï¼ˆcausal
graphï¼‰ï¼Œæ¨¡å‹ä¼šè‡ªåŠ¨æ ¹æ®å›¾ç»“æ„æ¨æ–­å“ªäº›æ˜¯å…±åŒåŸå› ã€å·¥å…·å˜é‡ç­‰ã€‚

## æŒ‡å®šå˜é‡åˆ—è¡¨ï¼ˆæ— å› æœå›¾ï¼‰

``` python
# æ²¡æœ‰ä¼ å…¥å› æœå›¾ï¼Œè€Œæ˜¯ç›´æ¥ä¼ å…¥å˜é‡åï¼Œæ¨¡å‹ä¸ä¼šå¸®ä½ è‡ªåŠ¨è¯†åˆ«
# é€‚ç”¨äºï¼Œå˜é‡ä¸å¤šï¼Œè‡ªå·±å¯ä»¥æ‰‹åŠ¨åˆ—å‡ºå“ªäº›æ˜¯å…±åŒåŸå› ï¼Œå“ªäº›æ˜¯ä¿®é¥°å˜é‡
model= CausalModel(
  data = df,
  treatment = data["treatment_name"],
  outcome = data["outcome_name"],
  common_causes = data["common_causes_names"],
  effect_modifiers = data["effect_modifier_names"]
)

model.view_model()
```

<img src="è®¡ç®—å› æœæ•ˆåº”çš„åŸºæœ¬ç¤ºä¾‹_files/figure-markdown_strict/unnamed-chunk-3-1.png" width="768" />

## ä½¿ç”¨å› æœå›¾ï¼ˆå› æœå›¾ï¼Œæ¨èï¼‰

``` python
# ä½¿ç”¨å› æœå›¾ï¼Œé€‚åˆå˜é‡ä¹‹é—´å…³ç³»å¤æ‚ï¼Œæˆ–è€…å˜é‡å¤ªå¤šï¼Œä¸å®¹æ˜“æ‰‹åŠ¨åˆ†ç±»çš„åœºæ™¯
model = CausalModel(
  data = df,
  treatment = data["treatment_name"],  # æŒ‡å®šæ²»ç–—å˜é‡å(è¿™é‡Œæ˜¯"v0")
  outcome = data["outcome_name"],      # æŒ‡å®šç»“æœå˜é‡å(è¿™é‡Œæ˜¯"y") 
  graph = data["gml_graph"]            # æä¾›å› æœå›¾
)

# å¯è§†åŒ–å› æœå›¾
model.view_model()
```

<img src="è®¡ç®—å› æœæ•ˆåº”çš„åŸºæœ¬ç¤ºä¾‹_files/figure-markdown_strict/unnamed-chunk-4-3.png" width="768" />

`.view_model()`ä¼šç”Ÿæˆå› æœå›¾åƒæ–‡ä»¶ï¼Œä¸Šå› æœå›¾å±•ç¤ºäº†å› æœæ¨¡å‹ä¸­æ‰€åŒ…å«çš„å‡è®¾ï¼Œå› æœå›¾æ¸…æ™°åœ°å±•ç¤ºäº†å˜é‡é—´çš„å› æœå…³ç³»ï¼š

-   Z0,Z1 â†’ v0 (å·¥å…·å˜é‡å½±å“æ²»ç–—)
-   W0-W4 â†’ v0 å’Œ W0-W4 â†’ y (æ··æ‚å› ç´ å½±å“æ²»ç–—å’Œç»“æœ)
-   v0 â†’ y (æ²»ç–—å½±å“ç»“æœ)
-   X0 â†’ y (æ•ˆåº”ä¿®é¥°å˜é‡å½±å“ç»“æœ)

è¿™é‡Œä½¿ç”¨äº†GMLæ ¼å¼çš„å› æœå›¾ï¼Œè¿™æ˜¯ä¸€ç§å›¾å½¢æè¿°è¯­è¨€ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å›¾æ¥è¯†åˆ«å› æœæ•ˆåº”ï¼ˆå³ä»å› æœä¼°è®¡é‡è½¬åŒ–ä¸ºæ¦‚ç‡è¡¨è¾¾å¼ï¼‰ï¼Œç„¶åå†ä¼°è®¡å› æœæ•ˆåº”ã€‚

# å› æœè¯†åˆ«

`DoWhy`çš„ç†å¿µï¼Œå°†è¯†åˆ« Identification ä¸ä¼°è®¡ Estimation åˆ†å¼€ã€‚

è¯†åˆ«é˜¶æ®µåªéœ€è¦è®¿é—®å› æœå›¾ï¼Œè€Œä¸éœ€è¦æ¥è§¦æ•°æ®ã€‚è¿™ä¸ªæ­¥éª¤ä¼šå¾—åˆ°ä¸€ä¸ªéœ€è¦è®¡ç®—çš„è¡¨è¾¾å¼ã€‚ä¹‹åï¼Œåœ¨ä¼°è®¡é˜¶æ®µï¼Œå¯ä»¥åˆ©ç”¨æ•°æ®æ¥è®¡ç®—è¯¥è¡¨è¾¾å¼ã€‚

éœ€è¦ç†è§£çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚

``` python
identified_estimand = model.identify_effect(proceed_when_unidentifiable = True)

print(identified_estimand)
## Estimand type: EstimandType.NONPARAMETRIC_ATE
## 
## ### Estimand : 1
## Estimand name: backdoor
## Estimand expression:
##   d                       
## â”€â”€â”€â”€â”€(E[y|W3,W4,W2,W0,W1])
## d[vâ‚€]                     
## Estimand assumption 1, Unconfoundedness: If Uâ†’{v0} and Uâ†’y then P(y|v0,W3,W4,W2,W0,W1,U) = P(y|v0,W3,W4,W2,W0,W1)
## 
## ### Estimand : 2
## Estimand name: iv
## Estimand expression:
##  â¡                              -1â¤
##  â¢    d        â›    d          â  â¥
## Eâ¢â”€â”€â”€â”€â”€â”€â”€â”€â”€(y)â‹…âœâ”€â”€â”€â”€â”€â”€â”€â”€â”€([vâ‚€])âŸ  â¥
##  â£d[Zâ‚  Zâ‚€]    âd[Zâ‚  Zâ‚€]      â   â¦
## Estimand assumption 1, As-if-random: If Uâ†’â†’y then Â¬(U â†’â†’{Z1,Z0})
## Estimand assumption 2, Exclusion: If we remove {Z1,Z0}â†’{v0}, then Â¬({Z1,Z0}â†’y)
## 
## ### Estimand : 3
## Estimand name: frontdoor
## No such variable(s) found!
```

`proceed_when_unidentifiable = True`è¡¨ç¤ºæˆ‘ä»¬å‡è®¾å¯ä»¥å¿½ç•¥ä»»ä½•æœªè§‚æµ‹åˆ°çš„æ··æ‚å› ç´ ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šæç¤ºç”¨æˆ·å†æ¬¡ç¡®è®¤æ˜¯å¦å¯ä»¥å¿½ç•¥æœªè§‚æµ‹æ··æ‚å› ç´ ã€‚

è¿™ä¸€æ­¥ä»…åŸºäºå› æœå›¾ç»“æ„å’Œå˜é‡å®šä¹‰ï¼Œæ¨å¯¼å‡º`åº”å¦‚ä½•è®¡ç®—`å› æœæ•ˆåº”ï¼Œå¹¶ç»™å‡ºè¡¨è¾¾å¼å’Œå‡è®¾ã€‚

åªè¦æ§åˆ¶ä½ W3, W4, W1, W0, W2 è¿™äº›æ··æ‚å˜é‡ï¼Œv0 å¯¹ y
çš„å¹³å‡å› æœæ•ˆåº”å°±æ˜¯å¯è¯†åˆ«çš„ã€‚

# å› æœæ•ˆåº”ä¼°è®¡

``` python
causal_estimate = model.estimate_effect(
  identified_estimand,
  method_name = "backdoor.propensity_score_stratification"
)

print(causal_estimate)
## *** Causal Estimate ***
## 
## ## Identified estimand
## Estimand type: EstimandType.NONPARAMETRIC_ATE
## 
## ### Estimand : 1
## Estimand name: backdoor
## Estimand expression:
##   d                       
## â”€â”€â”€â”€â”€(E[y|W3,W4,W2,W0,W1])
## d[vâ‚€]                     
## Estimand assumption 1, Unconfoundedness: If Uâ†’{v0} and Uâ†’y then P(y|v0,W3,W4,W2,W0,W1,U) = P(y|v0,W3,W4,W2,W0,W1)
## 
## ## Realized estimand
## b: y~v0+W3+W4+W2+W0+W1
## Target units: ate
## 
## ## Estimate
## Mean value: 11.262266744799229
```

ä¼°è®¡çš„å› æœæ•ˆåº”ä¸è®¾å®šçš„çœŸå®å€¼ 10
å¾ˆæ¥è¿‘ï¼Œä½†ç”±äºæ•°æ®ä¸­æœ‰å™ªå£°ï¼Œä¼°è®¡å€¼ä¸æ˜¯ç²¾ç¡®çš„ 10ã€‚

# ä¸åŒç¾¤ä½“çš„æ•ˆåº”ä¼°è®¡

``` python
estimate = model.estimate_effect(
  identified_estimand,
  method_name = "backdoor.propensity_score_stratification",
  target_units = "atc"
)

print(estimate)
## *** Causal Estimate ***
## 
## ## Identified estimand
## Estimand type: EstimandType.NONPARAMETRIC_ATE
## 
## ### Estimand : 1
## Estimand name: backdoor
## Estimand expression:
##   d                       
## â”€â”€â”€â”€â”€(E[y|W3,W4,W2,W0,W1])
## d[vâ‚€]                     
## Estimand assumption 1, Unconfoundedness: If Uâ†’{v0} and Uâ†’y then P(y|v0,W3,W4,W2,W0,W1,U) = P(y|v0,W3,W4,W2,W0,W1)
## 
## ## Realized estimand
## b: y~v0+W3+W4+W2+W0+W1
## Target units: atc
## 
## ## Estimate
## Mean value: 11.250168750807648
print("Causal Estimate is " + str(estimate.value))
## Causal Estimate is 11.250168750807648
```

`ate`ï¼Œå…¨ä½“æ ·æœ¬çš„å¹³å‡æ•ˆåº”

`att`ï¼Œæ²»ç–—ç»„çš„å¹³å‡æ•ˆåº”

`atc`ï¼Œå¯¹ç…§ç»„çš„å¹³å‡æ•ˆåº”

# æ¨¡å‹éªŒè¯

éªŒè¯æ˜¯ç¡®ä¿æˆ‘ä»¬çš„ä¼°è®¡å¯é çš„å…³é”®æ­¥éª¤ã€‚

éªŒè¯æ–¹æ³•ä¸ºæ¯ä¸€ä¸ªæ­£ç¡®çš„ä¼°è®¡å™¨æä¾›äº†åº”é€šè¿‡çš„æ£€éªŒï¼Œå¦‚æœæŸä¸ªä¼°è®¡å™¨æœªèƒ½é€šè¿‡éªŒè¯æ£€éªŒï¼ˆå³
p å€¼å°äº 0.05ï¼‰ï¼Œè¿™è¯´æ˜è¯¥ä¼°è®¡å™¨å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•éªŒè¯ä¼°è®¡å€¼ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œä½†å¦‚æœå®ƒè¿åäº†ä¸€äº›é¢„æœŸè¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥æ‹’ç»å®ƒï¼ˆç±»ä¼¼äºç§‘å­¦ç†è®ºå¯ä»¥è¢«è¯ä¼ªä½†æ— æ³•è¢«è¯æ˜ä¸ºçœŸï¼‰ã€‚

ä¸‹é¢çš„éªŒè¯æµ‹è¯•åŸºäºä»¥ä¸‹ä¸¤ç±»æ€è·¯ï¼š

-   ä¸å˜æ€§å˜æ¢ï¼ˆInvariant
    transformationsï¼‰ï¼šå¯¹æ•°æ®è¿›è¡Œä¸€äº›ä¸ä¼šæ”¹å˜å› æœæ•ˆåº”çš„å˜æ¢ã€‚ä»»ä½•åœ¨åŸå§‹æ•°æ®å’Œå˜æ¢åæ•°æ®ä¹‹é—´ç»“æœæœ‰æ˜¾è‘—å˜åŒ–çš„ä¼°è®¡å™¨ï¼Œéƒ½æœªé€šè¿‡è¯¥æµ‹è¯•ã€‚

-   å½’é›¶å˜æ¢ï¼ˆNullifying
    transformationsï¼‰ï¼šæ•°æ®ç»è¿‡æ”¹å˜åï¼ŒçœŸå®çš„å› æœæ•ˆåº”åº”ä¸ºé›¶ã€‚ä»»ä½•åœ¨æ–°æ•°æ®ä¸Šç»“æœæ˜¾è‘—åç¦»é›¶çš„ä¼°è®¡å™¨ï¼Œéƒ½æœªé€šè¿‡è¯¥æµ‹è¯•ã€‚

ä¸ºäº†ä¿è¯éªŒè¯å®éªŒç»“æœçš„å¯å¤ç°æ€§ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•éªŒè¯æ–¹æ³•ä¸­åŠ å…¥`random_seed`å‚æ•°ã€‚

è¿˜å¯ä»¥é€šè¿‡å†…ç½®çš„å¹¶è¡ŒåŒ–æœºåˆ¶åŠ é€ŸéªŒè¯è¿‡ç¨‹ï¼Œåªéœ€è®¾ç½® n_jobs å‚æ•°å¤§äº
1ï¼Œå³å¯å°†ä»»åŠ¡åˆ†é…åˆ°å¤šä¸ª CPUï¼Œæˆ–è®¾ç½®`n_jobs = -1`ä½¿ç”¨æ‰€æœ‰å¯ç”¨
CPUã€‚è¿™æ ·å¯ä»¥å¤§å¤§åŠ å¿«å¤§æ•°æ®é‡æˆ–éœ€è¦å¤šæ¬¡é‡å¤å®éªŒæ—¶çš„è®¡ç®—é€Ÿåº¦ã€‚

## æ·»åŠ éšæœºå…±åŒåŸå› 

æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„æ··æ‚å˜é‡ï¼Œå¦‚æœä¼°è®¡ç»“æœå˜åŒ–å¾ˆå¤§ï¼Œè¯´æ˜åŸä¼°è®¡ä¸å¯é ã€‚

``` python
res_random = model.refute_estimate(
  identified_estimand,
  estimate, 
  method_name = "random_common_cause",
  random_seed = 1,
  n_jobs = 1,
  show_progress_bar = True
)
## Refuting Estimates:   0%|[32m          [0m| 0/100 [00:00<?, ?it/s]Refuting Estimates:   1%|[32m1         [0m| 1/100 [00:00<00:10,  9.15it/s]Refuting Estimates:   2%|[32m2         [0m| 2/100 [00:00<00:10,  9.21it/s]Refuting Estimates:   3%|[32m3         [0m| 3/100 [00:00<00:10,  9.31it/s]Refuting Estimates:   4%|[32m4         [0m| 4/100 [00:00<00:10,  9.38it/s]Refuting Estimates:   5%|[32m5         [0m| 5/100 [00:00<00:10,  9.35it/s]Refuting Estimates:   6%|[32m6         [0m| 6/100 [00:00<00:10,  9.38it/s]Refuting Estimates:   7%|[32m7         [0m| 7/100 [00:00<00:09,  9.40it/s]Refuting Estimates:   8%|[32m8         [0m| 8/100 [00:00<00:10,  9.09it/s]Refuting Estimates:   9%|[32m9         [0m| 9/100 [00:00<00:10,  9.07it/s]Refuting Estimates:  10%|[32m#         [0m| 10/100 [00:01<00:09,  9.06it/s]Refuting Estimates:  11%|[32m#1        [0m| 11/100 [00:01<00:09,  8.99it/s]Refuting Estimates:  12%|[32m#2        [0m| 12/100 [00:01<00:09,  9.11it/s]Refuting Estimates:  13%|[32m#3        [0m| 13/100 [00:01<00:09,  9.06it/s]Refuting Estimates:  14%|[32m#4        [0m| 14/100 [00:01<00:09,  9.04it/s]Refuting Estimates:  15%|[32m#5        [0m| 15/100 [00:01<00:09,  9.07it/s]Refuting Estimates:  16%|[32m#6        [0m| 16/100 [00:01<00:09,  9.13it/s]Refuting Estimates:  17%|[32m#7        [0m| 17/100 [00:01<00:09,  9.16it/s]Refuting Estimates:  18%|[32m#8        [0m| 18/100 [00:01<00:09,  9.05it/s]Refuting Estimates:  19%|[32m#9        [0m| 19/100 [00:02<00:08,  9.01it/s]Refuting Estimates:  20%|[32m##        [0m| 20/100 [00:02<00:08,  9.11it/s]Refuting Estimates:  21%|[32m##1       [0m| 21/100 [00:02<00:08,  9.03it/s]Refuting Estimates:  22%|[32m##2       [0m| 22/100 [00:02<00:08,  9.01it/s]Refuting Estimates:  23%|[32m##3       [0m| 23/100 [00:02<00:08,  9.11it/s]Refuting Estimates:  24%|[32m##4       [0m| 24/100 [00:02<00:08,  9.16it/s]Refuting Estimates:  25%|[32m##5       [0m| 25/100 [00:02<00:08,  9.08it/s]Refuting Estimates:  26%|[32m##6       [0m| 26/100 [00:02<00:08,  9.07it/s]Refuting Estimates:  27%|[32m##7       [0m| 27/100 [00:02<00:08,  8.88it/s]Refuting Estimates:  28%|[32m##8       [0m| 28/100 [00:03<00:07,  9.03it/s]Refuting Estimates:  29%|[32m##9       [0m| 29/100 [00:03<00:07,  8.96it/s]Refuting Estimates:  30%|[32m###       [0m| 30/100 [00:03<00:07,  8.98it/s]Refuting Estimates:  31%|[32m###1      [0m| 31/100 [00:03<00:07,  9.08it/s]Refuting Estimates:  32%|[32m###2      [0m| 32/100 [00:03<00:07,  9.04it/s]Refuting Estimates:  33%|[32m###3      [0m| 33/100 [00:03<00:07,  9.12it/s]Refuting Estimates:  34%|[32m###4      [0m| 34/100 [00:03<00:07,  9.15it/s]Refuting Estimates:  35%|[32m###5      [0m| 35/100 [00:03<00:07,  9.25it/s]Refuting Estimates:  36%|[32m###6      [0m| 36/100 [00:03<00:06,  9.29it/s]Refuting Estimates:  37%|[32m###7      [0m| 37/100 [00:04<00:06,  9.20it/s]Refuting Estimates:  38%|[32m###8      [0m| 38/100 [00:04<00:06,  9.08it/s]Refuting Estimates:  39%|[32m###9      [0m| 39/100 [00:04<00:06,  9.05it/s]Refuting Estimates:  40%|[32m####      [0m| 40/100 [00:04<00:06,  8.93it/s]Refuting Estimates:  41%|[32m####1     [0m| 41/100 [00:04<00:06,  8.96it/s]Refuting Estimates:  42%|[32m####2     [0m| 42/100 [00:04<00:06,  9.07it/s]Refuting Estimates:  43%|[32m####3     [0m| 43/100 [00:04<00:06,  9.13it/s]Refuting Estimates:  44%|[32m####4     [0m| 44/100 [00:04<00:06,  9.16it/s]Refuting Estimates:  45%|[32m####5     [0m| 45/100 [00:04<00:06,  8.91it/s]Refuting Estimates:  46%|[32m####6     [0m| 46/100 [00:05<00:06,  8.94it/s]Refuting Estimates:  47%|[32m####6     [0m| 47/100 [00:05<00:05,  9.07it/s]Refuting Estimates:  48%|[32m####8     [0m| 48/100 [00:05<00:05,  9.09it/s]Refuting Estimates:  49%|[32m####9     [0m| 49/100 [00:05<00:05,  9.03it/s]Refuting Estimates:  50%|[32m#####     [0m| 50/100 [00:05<00:05,  9.06it/s]Refuting Estimates:  51%|[32m#####1    [0m| 51/100 [00:05<00:05,  9.12it/s]Refuting Estimates:  52%|[32m#####2    [0m| 52/100 [00:05<00:05,  9.11it/s]Refuting Estimates:  53%|[32m#####3    [0m| 53/100 [00:05<00:05,  9.07it/s]Refuting Estimates:  54%|[32m#####4    [0m| 54/100 [00:05<00:05,  8.76it/s]Refuting Estimates:  55%|[32m#####5    [0m| 55/100 [00:06<00:05,  8.62it/s]Refuting Estimates:  56%|[32m#####6    [0m| 56/100 [00:06<00:05,  8.62it/s]Refuting Estimates:  57%|[32m#####6    [0m| 57/100 [00:06<00:04,  8.75it/s]Refuting Estimates:  58%|[32m#####8    [0m| 58/100 [00:06<00:04,  8.77it/s]Refuting Estimates:  59%|[32m#####8    [0m| 59/100 [00:06<00:04,  8.89it/s]Refuting Estimates:  60%|[32m######    [0m| 60/100 [00:06<00:04,  8.98it/s]Refuting Estimates:  61%|[32m######1   [0m| 61/100 [00:06<00:04,  8.79it/s]Refuting Estimates:  62%|[32m######2   [0m| 62/100 [00:06<00:04,  8.96it/s]Refuting Estimates:  63%|[32m######3   [0m| 63/100 [00:06<00:04,  9.02it/s]Refuting Estimates:  64%|[32m######4   [0m| 64/100 [00:07<00:04,  8.96it/s]Refuting Estimates:  65%|[32m######5   [0m| 65/100 [00:07<00:03,  9.00it/s]Refuting Estimates:  66%|[32m######6   [0m| 66/100 [00:07<00:03,  8.76it/s]Refuting Estimates:  67%|[32m######7   [0m| 67/100 [00:07<00:03,  8.82it/s]Refuting Estimates:  68%|[32m######8   [0m| 68/100 [00:07<00:03,  8.99it/s]Refuting Estimates:  69%|[32m######9   [0m| 69/100 [00:07<00:03,  8.81it/s]Refuting Estimates:  70%|[32m#######   [0m| 70/100 [00:07<00:03,  8.92it/s]Refuting Estimates:  71%|[32m#######1  [0m| 71/100 [00:07<00:03,  8.96it/s]Refuting Estimates:  72%|[32m#######2  [0m| 72/100 [00:07<00:03,  8.96it/s]Refuting Estimates:  73%|[32m#######3  [0m| 73/100 [00:08<00:02,  9.02it/s]Refuting Estimates:  74%|[32m#######4  [0m| 74/100 [00:08<00:02,  8.85it/s]Refuting Estimates:  75%|[32m#######5  [0m| 75/100 [00:08<00:02,  8.97it/s]Refuting Estimates:  76%|[32m#######6  [0m| 76/100 [00:08<00:02,  8.99it/s]Refuting Estimates:  77%|[32m#######7  [0m| 77/100 [00:08<00:02,  8.90it/s]Refuting Estimates:  78%|[32m#######8  [0m| 78/100 [00:08<00:02,  9.01it/s]Refuting Estimates:  79%|[32m#######9  [0m| 79/100 [00:08<00:02,  8.95it/s]Refuting Estimates:  80%|[32m########  [0m| 80/100 [00:08<00:02,  9.00it/s]Refuting Estimates:  81%|[32m########1 [0m| 81/100 [00:08<00:02,  8.96it/s]Refuting Estimates:  82%|[32m########2 [0m| 82/100 [00:09<00:02,  8.90it/s]Refuting Estimates:  83%|[32m########2 [0m| 83/100 [00:09<00:01,  8.95it/s]Refuting Estimates:  84%|[32m########4 [0m| 84/100 [00:09<00:01,  8.87it/s]Refuting Estimates:  85%|[32m########5 [0m| 85/100 [00:09<00:01,  8.87it/s]Refuting Estimates:  86%|[32m########6 [0m| 86/100 [00:09<00:01,  8.95it/s]Refuting Estimates:  87%|[32m########7 [0m| 87/100 [00:09<00:01,  8.94it/s]Refuting Estimates:  88%|[32m########8 [0m| 88/100 [00:09<00:01,  8.71it/s]Refuting Estimates:  89%|[32m########9 [0m| 89/100 [00:09<00:01,  8.83it/s]Refuting Estimates:  90%|[32m######### [0m| 90/100 [00:10<00:01,  8.80it/s]Refuting Estimates:  91%|[32m#########1[0m| 91/100 [00:10<00:01,  8.83it/s]Refuting Estimates:  92%|[32m#########2[0m| 92/100 [00:10<00:00,  9.00it/s]Refuting Estimates:  93%|[32m#########3[0m| 93/100 [00:10<00:00,  9.01it/s]Refuting Estimates:  94%|[32m#########3[0m| 94/100 [00:10<00:00,  9.05it/s]Refuting Estimates:  95%|[32m#########5[0m| 95/100 [00:10<00:00,  8.98it/s]Refuting Estimates:  96%|[32m#########6[0m| 96/100 [00:10<00:00,  8.92it/s]Refuting Estimates:  97%|[32m#########7[0m| 97/100 [00:10<00:00,  8.99it/s]Refuting Estimates:  98%|[32m#########8[0m| 98/100 [00:10<00:00,  8.98it/s]Refuting Estimates:  99%|[32m#########9[0m| 99/100 [00:10<00:00,  9.06it/s]Refuting Estimates: 100%|[32m##########[0m| 100/100 [00:11<00:00,  9.08it/s]Refuting Estimates: 100%|[32m##########[0m| 100/100 [00:11<00:00,  9.00it/s]

print(res_random)
## Refute: Add a random common cause
## Estimated effect:11.250168750807648
## New effect:11.25016875080765
## p value:1.0
```

## ç”¨å®‰æ…°å‰‚å˜é‡æ›¿æ¢

å°†æ²»ç–—å˜é‡éšæœºæ‰“ä¹±ï¼Œç ´åçœŸå®çš„å› æœæ•ˆåº”ï¼›ç†è®ºä¸Šä¼°è®¡æ•ˆåº”åº”è¯¥æ¥è¿‘äº 0ã€‚

``` python
res_placebo = model.refute_estimate(
  identified_estimand, 
  estimate,
  method_name = "placebo_treatment_refuter",
  random_seed = 1,
  n_jobs = 1,
  show_progress_bar = True,
  placebo_type = "permute"
)
## Refuting Estimates:   0%|[32m          [0m| 0/100 [00:00<?, ?it/s]Refuting Estimates:   1%|[32m1         [0m| 1/100 [00:00<00:11,  8.85it/s]Refuting Estimates:   2%|[32m2         [0m| 2/100 [00:00<00:11,  8.78it/s]Refuting Estimates:   3%|[32m3         [0m| 3/100 [00:00<00:11,  8.73it/s]Refuting Estimates:   4%|[32m4         [0m| 4/100 [00:00<00:11,  8.67it/s]Refuting Estimates:   5%|[32m5         [0m| 5/100 [00:00<00:10,  8.73it/s]Refuting Estimates:   6%|[32m6         [0m| 6/100 [00:00<00:10,  8.76it/s]Refuting Estimates:   7%|[32m7         [0m| 7/100 [00:00<00:10,  8.77it/s]Refuting Estimates:   8%|[32m8         [0m| 8/100 [00:00<00:10,  8.79it/s]Refuting Estimates:   9%|[32m9         [0m| 9/100 [00:01<00:10,  8.89it/s]Refuting Estimates:  10%|[32m#         [0m| 10/100 [00:01<00:10,  8.93it/s]Refuting Estimates:  11%|[32m#1        [0m| 11/100 [00:01<00:10,  8.87it/s]Refuting Estimates:  12%|[32m#2        [0m| 12/100 [00:01<00:09,  8.86it/s]Refuting Estimates:  13%|[32m#3        [0m| 13/100 [00:01<00:09,  8.83it/s]Refuting Estimates:  14%|[32m#4        [0m| 14/100 [00:01<00:10,  8.43it/s]Refuting Estimates:  15%|[32m#5        [0m| 15/100 [00:01<00:10,  8.49it/s]Refuting Estimates:  16%|[32m#6        [0m| 16/100 [00:01<00:09,  8.64it/s]Refuting Estimates:  17%|[32m#7        [0m| 17/100 [00:01<00:09,  8.64it/s]Refuting Estimates:  18%|[32m#8        [0m| 18/100 [00:02<00:09,  8.57it/s]Refuting Estimates:  19%|[32m#9        [0m| 19/100 [00:02<00:09,  8.60it/s]Refuting Estimates:  20%|[32m##        [0m| 20/100 [00:02<00:09,  8.62it/s]Refuting Estimates:  21%|[32m##1       [0m| 21/100 [00:02<00:09,  8.68it/s]Refuting Estimates:  22%|[32m##2       [0m| 22/100 [00:02<00:09,  8.60it/s]Refuting Estimates:  23%|[32m##3       [0m| 23/100 [00:02<00:08,  8.70it/s]Refuting Estimates:  24%|[32m##4       [0m| 24/100 [00:02<00:08,  8.75it/s]Refuting Estimates:  25%|[32m##5       [0m| 25/100 [00:02<00:08,  8.75it/s]Refuting Estimates:  26%|[32m##6       [0m| 26/100 [00:02<00:08,  8.56it/s]Refuting Estimates:  27%|[32m##7       [0m| 27/100 [00:03<00:08,  8.39it/s]Refuting Estimates:  28%|[32m##8       [0m| 28/100 [00:03<00:08,  8.32it/s]Refuting Estimates:  29%|[32m##9       [0m| 29/100 [00:03<00:08,  8.32it/s]Refuting Estimates:  30%|[32m###       [0m| 30/100 [00:03<00:08,  8.50it/s]Refuting Estimates:  31%|[32m###1      [0m| 31/100 [00:03<00:08,  8.43it/s]Refuting Estimates:  32%|[32m###2      [0m| 32/100 [00:03<00:07,  8.58it/s]Refuting Estimates:  33%|[32m###3      [0m| 33/100 [00:03<00:07,  8.73it/s]Refuting Estimates:  34%|[32m###4      [0m| 34/100 [00:03<00:07,  8.63it/s]Refuting Estimates:  35%|[32m###5      [0m| 35/100 [00:04<00:07,  8.62it/s]Refuting Estimates:  36%|[32m###6      [0m| 36/100 [00:04<00:07,  8.74it/s]Refuting Estimates:  37%|[32m###7      [0m| 37/100 [00:04<00:07,  8.79it/s]Refuting Estimates:  38%|[32m###8      [0m| 38/100 [00:04<00:07,  8.81it/s]Refuting Estimates:  39%|[32m###9      [0m| 39/100 [00:04<00:06,  8.75it/s]Refuting Estimates:  40%|[32m####      [0m| 40/100 [00:04<00:06,  8.72it/s]Refuting Estimates:  41%|[32m####1     [0m| 41/100 [00:04<00:06,  8.83it/s]Refuting Estimates:  42%|[32m####2     [0m| 42/100 [00:04<00:06,  8.88it/s]Refuting Estimates:  43%|[32m####3     [0m| 43/100 [00:04<00:06,  8.98it/s]Refuting Estimates:  44%|[32m####4     [0m| 44/100 [00:05<00:06,  8.99it/s]Refuting Estimates:  45%|[32m####5     [0m| 45/100 [00:05<00:06,  8.64it/s]Refuting Estimates:  46%|[32m####6     [0m| 46/100 [00:05<00:06,  8.72it/s]Refuting Estimates:  47%|[32m####6     [0m| 47/100 [00:05<00:06,  8.68it/s]Refuting Estimates:  48%|[32m####8     [0m| 48/100 [00:05<00:05,  8.73it/s]Refuting Estimates:  49%|[32m####9     [0m| 49/100 [00:05<00:05,  8.71it/s]Refuting Estimates:  50%|[32m#####     [0m| 50/100 [00:05<00:05,  8.75it/s]Refuting Estimates:  51%|[32m#####1    [0m| 51/100 [00:05<00:05,  8.81it/s]Refuting Estimates:  52%|[32m#####2    [0m| 52/100 [00:05<00:05,  8.89it/s]Refuting Estimates:  53%|[32m#####3    [0m| 53/100 [00:06<00:05,  8.93it/s]Refuting Estimates:  54%|[32m#####4    [0m| 54/100 [00:06<00:05,  8.87it/s]Refuting Estimates:  55%|[32m#####5    [0m| 55/100 [00:06<00:05,  8.84it/s]Refuting Estimates:  56%|[32m#####6    [0m| 56/100 [00:06<00:05,  8.80it/s]Refuting Estimates:  57%|[32m#####6    [0m| 57/100 [00:06<00:04,  8.89it/s]Refuting Estimates:  58%|[32m#####8    [0m| 58/100 [00:06<00:04,  8.80it/s]Refuting Estimates:  59%|[32m#####8    [0m| 59/100 [00:06<00:04,  8.89it/s]Refuting Estimates:  60%|[32m######    [0m| 60/100 [00:06<00:04,  8.96it/s]Refuting Estimates:  61%|[32m######1   [0m| 61/100 [00:06<00:04,  9.05it/s]Refuting Estimates:  62%|[32m######2   [0m| 62/100 [00:07<00:04,  8.88it/s]Refuting Estimates:  63%|[32m######3   [0m| 63/100 [00:07<00:04,  8.70it/s]Refuting Estimates:  64%|[32m######4   [0m| 64/100 [00:07<00:04,  8.87it/s]Refuting Estimates:  65%|[32m######5   [0m| 65/100 [00:07<00:03,  8.95it/s]Refuting Estimates:  66%|[32m######6   [0m| 66/100 [00:07<00:03,  8.92it/s]Refuting Estimates:  67%|[32m######7   [0m| 67/100 [00:07<00:03,  8.80it/s]Refuting Estimates:  68%|[32m######8   [0m| 68/100 [00:07<00:03,  8.93it/s]Refuting Estimates:  69%|[32m######9   [0m| 69/100 [00:07<00:03,  9.01it/s]Refuting Estimates:  70%|[32m#######   [0m| 70/100 [00:07<00:03,  8.91it/s]Refuting Estimates:  71%|[32m#######1  [0m| 71/100 [00:08<00:03,  8.73it/s]Refuting Estimates:  72%|[32m#######2  [0m| 72/100 [00:08<00:03,  8.71it/s]Refuting Estimates:  73%|[32m#######3  [0m| 73/100 [00:08<00:03,  8.77it/s]Refuting Estimates:  74%|[32m#######4  [0m| 74/100 [00:08<00:02,  8.91it/s]Refuting Estimates:  75%|[32m#######5  [0m| 75/100 [00:08<00:02,  8.84it/s]Refuting Estimates:  76%|[32m#######6  [0m| 76/100 [00:08<00:02,  8.88it/s]Refuting Estimates:  77%|[32m#######7  [0m| 77/100 [00:08<00:02,  8.92it/s]Refuting Estimates:  78%|[32m#######8  [0m| 78/100 [00:08<00:02,  8.86it/s]Refuting Estimates:  79%|[32m#######9  [0m| 79/100 [00:09<00:02,  8.88it/s]Refuting Estimates:  80%|[32m########  [0m| 80/100 [00:09<00:02,  8.90it/s]Refuting Estimates:  81%|[32m########1 [0m| 81/100 [00:09<00:02,  8.90it/s]Refuting Estimates:  82%|[32m########2 [0m| 82/100 [00:09<00:02,  8.66it/s]Refuting Estimates:  83%|[32m########2 [0m| 83/100 [00:09<00:01,  8.76it/s]Refuting Estimates:  84%|[32m########4 [0m| 84/100 [00:09<00:01,  8.79it/s]Refuting Estimates:  85%|[32m########5 [0m| 85/100 [00:09<00:01,  8.92it/s]Refuting Estimates:  86%|[32m########6 [0m| 86/100 [00:09<00:01,  8.99it/s]Refuting Estimates:  87%|[32m########7 [0m| 87/100 [00:09<00:01,  9.04it/s]Refuting Estimates:  88%|[32m########8 [0m| 88/100 [00:10<00:01,  9.08it/s]Refuting Estimates:  89%|[32m########9 [0m| 89/100 [00:10<00:01,  8.85it/s]Refuting Estimates:  90%|[32m######### [0m| 90/100 [00:10<00:01,  8.95it/s]Refuting Estimates:  91%|[32m#########1[0m| 91/100 [00:10<00:00,  9.04it/s]Refuting Estimates:  92%|[32m#########2[0m| 92/100 [00:10<00:00,  8.89it/s]Refuting Estimates:  93%|[32m#########3[0m| 93/100 [00:10<00:00,  8.62it/s]Refuting Estimates:  94%|[32m#########3[0m| 94/100 [00:10<00:00,  8.42it/s]Refuting Estimates:  95%|[32m#########5[0m| 95/100 [00:10<00:00,  8.17it/s]Refuting Estimates:  96%|[32m#########6[0m| 96/100 [00:10<00:00,  8.32it/s]Refuting Estimates:  97%|[32m#########7[0m| 97/100 [00:11<00:00,  8.26it/s]Refuting Estimates:  98%|[32m#########8[0m| 98/100 [00:11<00:00,  8.39it/s]Refuting Estimates:  99%|[32m#########9[0m| 99/100 [00:11<00:00,  8.58it/s]Refuting Estimates: 100%|[32m##########[0m| 100/100 [00:11<00:00,  8.64it/s]Refuting Estimates: 100%|[32m##########[0m| 100/100 [00:11<00:00,  8.74it/s]

print(res_placebo)
## Refute: Use a Placebo Treatment
## Estimated effect:11.250168750807648
## New effect:0.0004172703150443136
## p value:0.98
```

## ç§»é™¤æ•°æ®ä¸­çš„éšæœºå­é›†

ç”¨éƒ¨åˆ†æ•°æ®é‡æ–°ä¼°è®¡ï¼Œç»“æœåº”è¯¥ä¸åŸä¼°è®¡å€¼ç›¸è¿‘ã€‚

``` python
res_subset = model.refute_estimate(
  identified_estimand,
  estimate,
  method_name = "data_subset_refuter",
  random_seed = 1,
  n_jobs = 1,
  show_progress_bar = True,
  subset_fraction = 0.9
)
## Refuting Estimates:   0%|[32m          [0m| 0/100 [00:00<?, ?it/s]Refuting Estimates:   1%|[32m1         [0m| 1/100 [00:00<00:10,  9.58it/s]Refuting Estimates:   3%|[32m3         [0m| 3/100 [00:00<00:10,  9.68it/s]Refuting Estimates:   4%|[32m4         [0m| 4/100 [00:00<00:10,  9.44it/s]Refuting Estimates:   5%|[32m5         [0m| 5/100 [00:00<00:10,  8.99it/s]Refuting Estimates:   6%|[32m6         [0m| 6/100 [00:00<00:10,  9.07it/s]Refuting Estimates:   7%|[32m7         [0m| 7/100 [00:00<00:10,  9.15it/s]Refuting Estimates:   8%|[32m8         [0m| 8/100 [00:00<00:10,  9.13it/s]Refuting Estimates:   9%|[32m9         [0m| 9/100 [00:00<00:09,  9.35it/s]Refuting Estimates:  11%|[32m#1        [0m| 11/100 [00:01<00:09,  9.72it/s]Refuting Estimates:  12%|[32m#2        [0m| 12/100 [00:01<00:09,  9.71it/s]Refuting Estimates:  13%|[32m#3        [0m| 13/100 [00:01<00:08,  9.78it/s]Refuting Estimates:  14%|[32m#4        [0m| 14/100 [00:01<00:08,  9.68it/s]Refuting Estimates:  15%|[32m#5        [0m| 15/100 [00:01<00:08,  9.48it/s]Refuting Estimates:  16%|[32m#6        [0m| 16/100 [00:01<00:08,  9.49it/s]Refuting Estimates:  18%|[32m#8        [0m| 18/100 [00:01<00:08,  9.64it/s]Refuting Estimates:  19%|[32m#9        [0m| 19/100 [00:02<00:08,  9.45it/s]Refuting Estimates:  20%|[32m##        [0m| 20/100 [00:02<00:08,  9.32it/s]Refuting Estimates:  21%|[32m##1       [0m| 21/100 [00:02<00:08,  9.37it/s]Refuting Estimates:  22%|[32m##2       [0m| 22/100 [00:02<00:08,  9.48it/s]Refuting Estimates:  23%|[32m##3       [0m| 23/100 [00:02<00:08,  9.22it/s]Refuting Estimates:  24%|[32m##4       [0m| 24/100 [00:02<00:08,  9.16it/s]Refuting Estimates:  25%|[32m##5       [0m| 25/100 [00:02<00:08,  9.34it/s]Refuting Estimates:  26%|[32m##6       [0m| 26/100 [00:02<00:07,  9.43it/s]Refuting Estimates:  28%|[32m##8       [0m| 28/100 [00:02<00:07,  9.73it/s]Refuting Estimates:  29%|[32m##9       [0m| 29/100 [00:03<00:07,  9.70it/s]Refuting Estimates:  31%|[32m###1      [0m| 31/100 [00:03<00:07,  9.86it/s]Refuting Estimates:  32%|[32m###2      [0m| 32/100 [00:03<00:06,  9.85it/s]Refuting Estimates:  33%|[32m###3      [0m| 33/100 [00:03<00:06,  9.79it/s]Refuting Estimates:  34%|[32m###4      [0m| 34/100 [00:03<00:06,  9.69it/s]Refuting Estimates:  35%|[32m###5      [0m| 35/100 [00:03<00:06,  9.48it/s]Refuting Estimates:  36%|[32m###6      [0m| 36/100 [00:03<00:06,  9.50it/s]Refuting Estimates:  38%|[32m###8      [0m| 38/100 [00:03<00:06,  9.51it/s]Refuting Estimates:  39%|[32m###9      [0m| 39/100 [00:04<00:06,  9.47it/s]Refuting Estimates:  40%|[32m####      [0m| 40/100 [00:04<00:06,  9.60it/s]Refuting Estimates:  41%|[32m####1     [0m| 41/100 [00:04<00:06,  9.57it/s]Refuting Estimates:  42%|[32m####2     [0m| 42/100 [00:04<00:06,  9.56it/s]Refuting Estimates:  43%|[32m####3     [0m| 43/100 [00:04<00:05,  9.68it/s]Refuting Estimates:  45%|[32m####5     [0m| 45/100 [00:04<00:05,  9.79it/s]Refuting Estimates:  46%|[32m####6     [0m| 46/100 [00:04<00:05,  9.84it/s]Refuting Estimates:  47%|[32m####6     [0m| 47/100 [00:04<00:05,  9.81it/s]Refuting Estimates:  48%|[32m####8     [0m| 48/100 [00:05<00:05,  9.68it/s]Refuting Estimates:  49%|[32m####9     [0m| 49/100 [00:05<00:05,  9.73it/s]Refuting Estimates:  50%|[32m#####     [0m| 50/100 [00:05<00:05,  9.76it/s]Refuting Estimates:  51%|[32m#####1    [0m| 51/100 [00:05<00:05,  9.73it/s]Refuting Estimates:  52%|[32m#####2    [0m| 52/100 [00:05<00:05,  9.51it/s]Refuting Estimates:  53%|[32m#####3    [0m| 53/100 [00:05<00:05,  9.33it/s]Refuting Estimates:  54%|[32m#####4    [0m| 54/100 [00:05<00:04,  9.50it/s]Refuting Estimates:  55%|[32m#####5    [0m| 55/100 [00:05<00:04,  9.53it/s]Refuting Estimates:  56%|[32m#####6    [0m| 56/100 [00:05<00:04,  9.37it/s]Refuting Estimates:  57%|[32m#####6    [0m| 57/100 [00:05<00:04,  9.49it/s]Refuting Estimates:  58%|[32m#####8    [0m| 58/100 [00:06<00:04,  9.61it/s]Refuting Estimates:  59%|[32m#####8    [0m| 59/100 [00:06<00:04,  9.66it/s]Refuting Estimates:  60%|[32m######    [0m| 60/100 [00:06<00:04,  9.68it/s]Refuting Estimates:  62%|[32m######2   [0m| 62/100 [00:06<00:03,  9.75it/s]Refuting Estimates:  64%|[32m######4   [0m| 64/100 [00:06<00:03,  9.92it/s]Refuting Estimates:  65%|[32m######5   [0m| 65/100 [00:06<00:03,  9.76it/s]Refuting Estimates:  66%|[32m######6   [0m| 66/100 [00:06<00:03,  9.77it/s]Refuting Estimates:  67%|[32m######7   [0m| 67/100 [00:06<00:03,  9.71it/s]Refuting Estimates:  69%|[32m######9   [0m| 69/100 [00:07<00:03,  9.93it/s]Refuting Estimates:  70%|[32m#######   [0m| 70/100 [00:07<00:03,  9.93it/s]Refuting Estimates:  71%|[32m#######1  [0m| 71/100 [00:07<00:02,  9.89it/s]Refuting Estimates:  72%|[32m#######2  [0m| 72/100 [00:07<00:02,  9.79it/s]Refuting Estimates:  74%|[32m#######4  [0m| 74/100 [00:07<00:02,  9.72it/s]Refuting Estimates:  75%|[32m#######5  [0m| 75/100 [00:07<00:02,  9.76it/s]Refuting Estimates:  76%|[32m#######6  [0m| 76/100 [00:07<00:02,  9.67it/s]Refuting Estimates:  77%|[32m#######7  [0m| 77/100 [00:08<00:02,  9.63it/s]Refuting Estimates:  79%|[32m#######9  [0m| 79/100 [00:08<00:02,  9.80it/s]Refuting Estimates:  81%|[32m########1 [0m| 81/100 [00:08<00:01,  9.84it/s]Refuting Estimates:  82%|[32m########2 [0m| 82/100 [00:08<00:01,  9.77it/s]Refuting Estimates:  83%|[32m########2 [0m| 83/100 [00:08<00:01,  9.24it/s]Refuting Estimates:  84%|[32m########4 [0m| 84/100 [00:08<00:01,  8.96it/s]Refuting Estimates:  85%|[32m########5 [0m| 85/100 [00:09<00:02,  6.72it/s]Refuting Estimates:  86%|[32m########6 [0m| 86/100 [00:09<00:02,  5.61it/s]Refuting Estimates:  87%|[32m########7 [0m| 87/100 [00:09<00:02,  5.92it/s]Refuting Estimates:  88%|[32m########8 [0m| 88/100 [00:09<00:01,  6.40it/s]Refuting Estimates:  89%|[32m########9 [0m| 89/100 [00:09<00:01,  6.23it/s]Refuting Estimates:  90%|[32m######### [0m| 90/100 [00:09<00:01,  6.53it/s]Refuting Estimates:  91%|[32m#########1[0m| 91/100 [00:09<00:01,  7.08it/s]Refuting Estimates:  92%|[32m#########2[0m| 92/100 [00:10<00:01,  7.54it/s]Refuting Estimates:  93%|[32m#########3[0m| 93/100 [00:10<00:00,  7.76it/s]Refuting Estimates:  94%|[32m#########3[0m| 94/100 [00:10<00:00,  8.18it/s]Refuting Estimates:  95%|[32m#########5[0m| 95/100 [00:10<00:00,  8.65it/s]Refuting Estimates:  96%|[32m#########6[0m| 96/100 [00:10<00:00,  8.88it/s]Refuting Estimates:  98%|[32m#########8[0m| 98/100 [00:10<00:00,  9.30it/s]Refuting Estimates:  99%|[32m#########9[0m| 99/100 [00:10<00:00,  9.37it/s]Refuting Estimates: 100%|[32m##########[0m| 100/100 [00:10<00:00,  9.45it/s]Refuting Estimates: 100%|[32m##########[0m| 100/100 [00:10<00:00,  9.15it/s]
        
print(res_subset)
## Refute: Use a subset of data
## Estimated effect:11.250168750807648
## New effect:11.312134931369112
## p value:0.5
```

## æ·»åŠ æœªè§‚æµ‹å…±åŒåŸå› å˜é‡

è¿™ç§éªŒè¯æ–¹æ³•ä¸æ˜¯é€šè¿‡ p
å€¼æ¥åˆ¤æ–­ç»“æœï¼Œè€Œæ˜¯ä½œä¸ºä¸€ç§æ•æ„Ÿæ€§åˆ†æï¼Œç”¨äºè¡¡é‡å¦‚æœ**æ‰€æœ‰å…±åŒåŸå› éƒ½å·²è§‚æµ‹**è¿™ä¸€å‡è®¾ä¸æˆç«‹æ—¶ï¼Œä¼°è®¡ç»“æœä¼šå¤šå¿«å‘ç”Ÿæ”¹å˜ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæ£€éªŒå¯¹**åé—¨å‡è®¾**è¿åçš„æ•æ„Ÿæ€§ï¼šå³å‡è®¾æ‰€æœ‰çš„å…±åŒåŸå› éƒ½è¢«è§‚æµ‹åˆ°ã€‚

ä¹Ÿå¯ä»¥å°†è¯¥æ–¹æ³•ç†è§£ä¸ºï¼Œå‡è®¾åŸå§‹æ•°æ®ä¸­æœ¬å°±å­˜åœ¨æœªè§‚æµ‹æ··æ‚ï¼Œæ”¹å˜å¤„ç†å’Œç»“æœçš„å€¼ï¼Œæ¶ˆé™¤åŸæœ¬æœªè§‚æµ‹å…±åŒåŸå› çš„å½±å“ï¼Œç„¶åå†é‡æ–°ä¼°è®¡å› æœæ•ˆåº”ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ŒåŸå§‹å’Œæ–°ä¼°è®¡å€¼çš„å·®å¼‚åº”åœ¨ä¸€ä¸ªå¯æ¥å—çš„èŒƒå›´å†…ã€‚

æ¨¡æ‹Ÿå­˜åœ¨æœªè§‚æµ‹æ··æ‚å› ç´ çš„æƒ…å†µï¼Œæµ‹è¯•ä¼°è®¡å€¼å¯¹æ··æ‚çš„æ•æ„Ÿç¨‹åº¦ã€‚

### å•ä¸€å¼ºåº¦ä¸‹çš„æ•æ„Ÿæ€§åˆ†æ

``` python
res_unobserved = model.refute_estimate(
  identified_estimand,
  estimate, 
  random_seed = 1,
  n_jobs = 1,
  method_name = "add_unobserved_common_cause",
  confounders_effect_on_treatment = "binary_flip",
  confounders_effect_on_outcome = "linear",
  effect_strength_on_treatment = 0.01,
  effect_strength_on_outcome = 0.02
)

print(res_unobserved)
## Refute: Add an Unobserved Common Cause
## Estimated effect:11.250168750807648
## New effect:11.184766098500258
```

å‡è®¾æˆ‘ä»¬è®¾å®šæœªè§‚æµ‹å…±åŒåŸå›  U å¯¹å¤„ç†çš„æ•ˆåº”ä¸º 0.01ï¼Œå¯¹ç»“æœçš„æ•ˆåº”ä¸º
0.02ã€‚ä¹Ÿå¯ä»¥å¤šæ¬¡å°è¯•ä¸åŒå¼ºåº¦ï¼Œç»˜åˆ¶æ•æ„Ÿæ€§æ›²çº¿ï¼Œç›´è§‚å±•ç¤ºä¼°è®¡éšæœªè§‚æµ‹æ··æ‚æ•ˆåº”å˜åŒ–çš„è¶‹åŠ¿ã€‚

é€šå¸¸ï¼Œæ›´æœ‰ç”¨çš„åšæ³•æ˜¯è§‚å¯Ÿæœªè§‚æµ‹æ··æ‚æ•ˆåº”é€æ­¥å¢å¼ºæ—¶ï¼Œä¼°è®¡å› æœæ•ˆåº”çš„å˜åŒ–è¶‹åŠ¿ï¼Œå¯ä»¥å‘éªŒè¯æ–¹æ³•æä¾›ä¸€ç»„å‡å®šçš„æ··æ‚å˜é‡æ•ˆåº”ã€‚æ–¹æ³•ä¼šé’ˆå¯¹æ¯ä¸€ç»„å‡å®šå€¼åˆ†åˆ«è¿›è¡Œæ•æ„Ÿæ€§åˆ†æï¼Œè¾“å‡ºåœ¨è¿™äº›ä¸åŒæœªè§‚æµ‹æ··æ‚å½±å“ä¸‹ï¼Œä¼°è®¡å› æœæ•ˆåº”çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼ˆå³åŒºé—´èŒƒå›´ï¼‰ã€‚

``` python
res_unobserved_range = model.refute_estimate(
  identified_estimand, estimate,
  random_seed = 1,
  n_jobs = 1,
  method_name = "add_unobserved_common_cause",
  confounders_effect_on_treatment = "binary_flip",
  confounders_effect_on_outcome = "linear",
  effect_strength_on_treatment = np.array([0.001, 0.005, 0.01, 0.02]), 
  effect_strength_on_outcome = 0.01
)
```

<img src="è®¡ç®—å› æœæ•ˆåº”çš„åŸºæœ¬ç¤ºä¾‹_files/figure-markdown_strict/unnamed-chunk-12-5.png" width="576" />

``` python

print(res_unobserved_range)
## Refute: Add an Unobserved Common Cause
## Estimated effect:11.250168750807648
## New effect:(10.476642918519385, 11.215118666125967)
```

ä¸Šé¢çš„å›¾å±•ç¤ºäº†éšç€å‡å®šæ··æ‚å¯¹å¤„ç†çš„å½±å“å¢å¼ºï¼Œä¼°è®¡çš„å› æœæ•ˆåº”é€æ¸å‡å°ã€‚

ç»“åˆé¢†åŸŸçŸ¥è¯†ï¼Œæˆ‘ä»¬é€šå¸¸èƒ½å¤Ÿåˆ¤æ–­æ··æ‚å¯¹å¤„ç†å˜é‡çš„æœ€å¤§åˆç†å½±å“èŒƒå›´ã€‚åªè¦åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œå› æœæ•ˆåº”çš„ä¼°è®¡å€¼å§‹ç»ˆå¤§äºé›¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¾ƒä¸ºæœ‰ä¿¡å¿ƒåœ°è®¤ä¸ºå¤„ç†å˜é‡
v0 çš„å› æœæ•ˆåº”ä¸ºæ­£ã€‚

### äºŒç»´çƒ­åŠ›å›¾è¡¨ç¤º

``` python
res_unobserved_range = model.refute_estimate(
  identified_estimand, 
  estimate,
  random_seed = 1,
  n_jobs = 1,
  method_name = "add_unobserved_common_cause",
  confounders_effect_on_treatment = "binary_flip",
  confounders_effect_on_outcome = "linear",
  effect_strength_on_treatment = [0.001, 0.005, 0.01, 0.02],
  effect_strength_on_outcome = [0.001, 0.005, 0.01,0.02]
)
```

<img src="è®¡ç®—å› æœæ•ˆåº”çš„åŸºæœ¬ç¤ºä¾‹_files/figure-markdown_strict/unnamed-chunk-13-7.png" width="576" />

``` python

print(res_unobserved_range)
## Refute: Add an Unobserved Common Cause
## Estimated effect:11.250168750807648
## New effect:(7.946540748041179, 11.164309815619722)
```

### è‡ªåŠ¨æ¨æ–­æ··æ‚å½±å“å¼ºåº¦å‚æ•°

DoWhy
æ”¯æŒè‡ªåŠ¨é€‰æ‹©æœªè§‚æµ‹æ··æ‚å˜é‡çš„æ•ˆåº”å¼ºåº¦å‚æ•°ã€‚å…¶æ ¸å¿ƒå‡è®¾æ˜¯ï¼Œæœªè§‚æµ‹æ··æ‚å˜é‡å¯¹å¤„ç†æˆ–ç»“æœçš„æ•ˆåº”ä¸ä¼šå¼ºäºä»»ä½•å·²è§‚æµ‹æ··æ‚å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å·²ç»æ”¶é›†åˆ°äº†æœ€ç›¸å…³çš„æ··æ‚å˜é‡æ•°æ®ã€‚åŸºäºè¿™ä¸ªå‡è®¾ï¼ŒDoWhy
ä¼šè‡ªåŠ¨ä½¿ç”¨å·²è§‚æµ‹æ··æ‚ä¸­æœ€å¤§æ•ˆåº”å¼ºåº¦æ¥ä½œä¸ºæœªè§‚æµ‹æ··æ‚å½±å“çš„ä¸Šç•Œï¼Œä»è€Œè‡ªåŠ¨è®¾ç½®
effect_strength_on_treatment å’Œ effect_strength_on_outcome
çš„å–å€¼èŒƒå›´ã€‚

``` python
res_unobserved_auto = model.refute_estimate(
  identified_estimand, 
  estimate,
  random_seed = 1,
  n_jobs = 1,
  method_name = "add_unobserved_common_cause",
  confounders_effect_on_treatment = "binary_flip",
  confounders_effect_on_outcome = "linear"
)
```

<img src="è®¡ç®—å› æœæ•ˆåº”çš„åŸºæœ¬ç¤ºä¾‹_files/figure-markdown_strict/unnamed-chunk-14-9.png" width="576" />

``` python

print(res_unobserved_auto)
## Refute: Add an Unobserved Common Cause
## Estimated effect:11.250168750807648
## New effect:(-0.5424084016204305, 10.91905973887223)
```

# ç»“è®º

å‡è®¾æœªè§‚æµ‹æ··æ‚å˜é‡å¯¹å¤„ç†æˆ–ç»“æœçš„å½±å“ä¸å¼ºäºä»»ä½•å·²è§‚æµ‹æ··æ‚å˜é‡ï¼Œåˆ™å¯ä»¥å¾—å‡ºç»“è®ºï¼šå¤„ç†çš„å› æœæ•ˆåº”ä¸ºæ­£ã€‚

æ¢å¥è¯è¯´ï¼Œåœ¨è¿™ä¸€åˆç†çš„æ•æ„Ÿæ€§å‡è®¾ä¸‹ï¼Œå³ä¾¿è€ƒè™‘äº†æ½œåœ¨çš„æœªè§‚æµ‹æ··æ‚ï¼Œä¼°è®¡å‡ºçš„å› æœæ•ˆåº”ä¾ç„¶æ˜¯æ­£å‘çš„ï¼Œå› æ­¤æˆ‘ä»¬çš„ç»“è®ºå…·æœ‰è¾ƒå¼ºçš„ç¨³å¥æ€§ã€‚
